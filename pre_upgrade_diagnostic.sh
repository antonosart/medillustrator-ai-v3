#!/bin/bash
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üîç MedIllustrator-AI - COMPLETE PRE-v3.1 UPGRADE DIAGNOSTIC"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

# ============================================================================
# 1. CURRENT ENVIRONMENT
# ============================================================================
echo "üìç 1. CURRENT ENVIRONMENT"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "Active Project: $(gcloud config get-value project)"
echo "Region: $(gcloud config get-value compute/region)"
echo "Zone: $(gcloud config get-value compute/zone)"
echo "User: $(gcloud config get-value account)"
echo "Cloud Shell Directory: $(pwd)"
echo ""

# ============================================================================
# 2. EXISTING FILES IN CLOUD SHELL
# ============================================================================
echo "üìÅ 2. EXISTING FILES IN CLOUD SHELL"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "Home Directory Contents:"
ls -lah ~/ | grep -E "(medill|medical|app|\.zip|\.py)" || echo "No relevant files found"
echo ""

echo "Checking common directories:"
for dir in ~/medillustrator* ~/medical* ~/app* ~/code*; do
  if [ -d "$dir" ]; then
    echo ""
    echo "‚úÖ Found: $dir"
    ls -lh "$dir" | head -15
  fi
done

# Check for uploaded zips
echo ""
echo "Uploaded packages (*.zip):"
find ~/ -maxdepth 2 -name "*.zip" -type f 2>/dev/null || echo "No zip files found"
echo ""

# ============================================================================
# 3. CURRENT RUNNING SERVICE DETAILS
# ============================================================================
echo "üöÄ 3. CURRENT RUNNING SERVICE"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

# Make sure we're in the right project
gcloud config set project medical-image-ai >/dev/null 2>&1

SERVICE_NAME="medillustrator"
REGION="europe-west1"

if gcloud run services describe $SERVICE_NAME --region $REGION >/dev/null 2>&1; then
    echo "Service Name: $SERVICE_NAME"
    echo "Region: $REGION"
    echo ""
    
    echo "Current Configuration:"
    echo "  URL: $(gcloud run services describe $SERVICE_NAME --region $REGION --format='value(status.url)')"
    echo "  Memory: $(gcloud run services describe $SERVICE_NAME --region $REGION --format='value(spec.template.spec.containers[0].resources.limits.memory)')"
    echo "  CPU: $(gcloud run services describe $SERVICE_NAME --region $REGION --format='value(spec.template.spec.containers[0].resources.limits.cpu)')"
    echo ""
    
    echo "Environment Variables (current):"
    gcloud run services describe $SERVICE_NAME --region $REGION \
      --format="value(spec.template.spec.containers[0].env)" | \
      grep -E "(VERSION|ART|CLIP|LANGCHAIN)" || echo "  Basic configuration"
    echo ""
    
    echo "Container Image:"
    gcloud run services describe $SERVICE_NAME --region $REGION \
      --format="value(spec.template.spec.containers[0].image)"
    echo ""
    
    echo "Last Deployment:"
    gcloud run services describe $SERVICE_NAME --region $REGION \
      --format="value(metadata.creationTimestamp)"
else
    echo "‚ö†Ô∏è  Service not found or not accessible"
fi
echo ""

# ============================================================================
# 4. SECRETS CONFIGURATION
# ============================================================================
echo "üîê 4. SECRETS IN SECRET MANAGER"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
gcloud secrets list --format="table(name,createTime)" 2>/dev/null || echo "No secrets found"
echo ""

# ============================================================================
# 5. STORAGE BUCKETS
# ============================================================================
echo "üóÑÔ∏è  5. STORAGE BUCKETS"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
gsutil ls 2>/dev/null | grep -E "medical|medill" || echo "No relevant buckets found"
echo ""

# ============================================================================
# 6. ARTIFACT REGISTRY
# ============================================================================
echo "üê≥ 6. CONTAINER REGISTRY"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
gcloud artifacts repositories list --location=europe-west1 \
  --format="table(name,format,createTime)" 2>/dev/null || echo "No repositories found"
echo ""

# Check for existing images
echo "Existing Container Images:"
gcloud artifacts docker images list europe-west1-docker.pkg.dev/medical-image-ai/medillustrator \
  --format="table(image,createTime,updateTime)" 2>/dev/null | head -10 || echo "No images found"
echo ""

# ============================================================================
# 7. CURRENT vs TARGET v3.1 STRUCTURE
# ============================================================================
echo "üìä 7. CURRENT vs TARGET v3.1 STRUCTURE"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

# Check if we have any existing project directory
PROJECT_DIR=$(find ~/ -maxdepth 1 -type d -name "*medill*" 2>/dev/null | head -1)

if [ -n "$PROJECT_DIR" ]; then
    echo "Existing Project Directory: $PROJECT_DIR"
    echo ""
    echo "Current Structure:"
    tree -L 2 "$PROJECT_DIR" 2>/dev/null || find "$PROJECT_DIR" -maxdepth 2 -type d | head -20
    echo ""
else
    echo "‚ö†Ô∏è  No existing project directory found"
    echo "Will create fresh structure"
fi

echo ""
echo "Target v3.1 Structure (what we need to create):"
cat << 'TARGET_STRUCTURE'
medillustrator-v3.1/
‚îú‚îÄ‚îÄ app_v3_langgraph.py          [FROM UPLOAD]
‚îú‚îÄ‚îÄ requirements-enhanced.txt    [FROM UPLOAD]
‚îú‚îÄ‚îÄ Dockerfile                   [CREATE NEW]
‚îú‚îÄ‚îÄ .dockerignore                [CREATE NEW]
‚îú‚îÄ‚îÄ README_v31.md                [CREATE NEW]
‚îÇ
‚îú‚îÄ‚îÄ config/                      [FROM UPLOAD + ENHANCE]
‚îÇ   ‚îú‚îÄ‚îÄ settings.py             [EXISTING]
‚îÇ   ‚îî‚îÄ‚îÄ art_settings.py         [CREATE NEW - v3.1]
‚îÇ
‚îú‚îÄ‚îÄ agents/                      [FROM UPLOAD]
‚îú‚îÄ‚îÄ workflows/                   [FROM UPLOAD]
‚îú‚îÄ‚îÄ core/                        [FROM UPLOAD]
‚îú‚îÄ‚îÄ data/                        [FROM UPLOAD]
‚îÇ   ‚îî‚îÄ‚îÄ ontology_terms.csv
‚îÇ
‚îú‚îÄ‚îÄ training/                    [CREATE NEW - v3.1]
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ models/                      [CREATE NEW - v3.1]
‚îÇ   ‚îú‚îÄ‚îÄ baseline/
‚îÇ   ‚îú‚îÄ‚îÄ checkpoints/
‚îÇ   ‚îî‚îÄ‚îÄ production/
‚îú‚îÄ‚îÄ evaluation/                  [CREATE NEW - v3.1]
‚îú‚îÄ‚îÄ notebooks/                   [CREATE NEW - v3.1]
‚îî‚îÄ‚îÄ examples/                    [CREATE NEW - v3.1]
TARGET_STRUCTURE
echo ""

# ============================================================================
# 8. DEPENDENCY CHECK
# ============================================================================
echo "üîß 8. REQUIRED TOOLS & DEPENDENCIES"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "Python Version: $(python3 --version 2>/dev/null || echo 'Not found')"
echo "gcloud Version: $(gcloud --version | head -1)"
echo "Docker Available: $(command -v docker >/dev/null && echo 'Yes' || echo 'No (not needed)')"
echo "unzip Available: $(command -v unzip >/dev/null && echo 'Yes ‚úÖ' || echo 'No ‚ùå')"
echo "tree Available: $(command -v tree >/dev/null && echo 'Yes' || echo 'No (optional)')"
echo ""

# ============================================================================
# 9. NETWORK & ACCESS CHECK
# ============================================================================
echo "üåê 9. NETWORK & ACCESS VERIFICATION"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

# Test service endpoint
if [ -n "$SERVICE_NAME" ]; then
    SERVICE_URL=$(gcloud run services describe $SERVICE_NAME --region $REGION --format='value(status.url)' 2>/dev/null)
    if [ -n "$SERVICE_URL" ]; then
        echo "Testing service endpoint..."
        HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" "$SERVICE_URL" -m 10)
        if [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ Service is responding (HTTP $HTTP_CODE)"
        else
            echo "‚ö†Ô∏è  Service returned HTTP $HTTP_CODE"
        fi
    fi
fi

# Test API connectivity
echo ""
echo "API Access Check:"
gcloud secrets list --limit 1 >/dev/null 2>&1 && echo "‚úÖ Secret Manager: Accessible" || echo "‚ö†Ô∏è  Secret Manager: Issue"
gsutil ls >/dev/null 2>&1 && echo "‚úÖ Cloud Storage: Accessible" || echo "‚ö†Ô∏è  Cloud Storage: Issue"
gcloud run services list --limit 1 >/dev/null 2>&1 && echo "‚úÖ Cloud Run: Accessible" || echo "‚ö†Ô∏è  Cloud Run: Issue"
echo ""

# ============================================================================
# 10. DISK SPACE & RESOURCES
# ============================================================================
echo "üíæ 10. AVAILABLE RESOURCES"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "Cloud Shell Disk Space:"
df -h ~ | grep -E "(Filesystem|/$|/home)" | head -2
echo ""
echo "Available Memory:"
free -h | grep -E "(total|Mem:)"
echo ""

# ============================================================================
# 11. RECENT ACTIVITY LOG
# ============================================================================
echo "üìù 11. RECENT SERVICE LOGS (Last 5)"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
if [ -n "$SERVICE_NAME" ]; then
    gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=$SERVICE_NAME" \
      --limit 5 \
      --format="table(timestamp.date('%Y-%m-%d %H:%M:%S'),severity,textPayload)" 2>/dev/null || \
      echo "No recent logs available"
fi
echo ""

# ============================================================================
# 12. UPGRADE READINESS CHECKLIST
# ============================================================================
echo "‚úÖ 12. UPGRADE READINESS CHECKLIST"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

READY_COUNT=0
TOTAL_CHECKS=8

# Check 1: Project access
if gcloud config get-value project >/dev/null 2>&1; then
    echo "‚úÖ [1/8] Project access configured"
    ((READY_COUNT++))
else
    echo "‚ùå [1/8] Project access issue"
fi

# Check 2: Service running
if gcloud run services describe medillustrator --region europe-west1 >/dev/null 2>&1; then
    echo "‚úÖ [2/8] Current service accessible"
    ((READY_COUNT++))
else
    echo "‚ùå [2/8] Service not accessible"
fi

# Check 3: Secrets configured
SECRET_COUNT=$(gcloud secrets list --format="value(name)" 2>/dev/null | wc -l)
if [ "$SECRET_COUNT" -gt 0 ]; then
    echo "‚úÖ [3/8] Secrets configured ($SECRET_COUNT secrets)"
    ((READY_COUNT++))
else
    echo "‚ùå [3/8] No secrets found"
fi

# Check 4: Billing enabled
if gcloud billing projects describe $(gcloud config get-value project) --format="value(billingEnabled)" 2>/dev/null | grep -q "True"; then
    echo "‚úÖ [4/8] Billing enabled"
    ((READY_COUNT++))
else
    echo "‚ö†Ô∏è  [4/8] Billing status unclear"
fi

# Check 5: Storage available
if gsutil ls >/dev/null 2>&1; then
    echo "‚úÖ [5/8] Cloud Storage accessible"
    ((READY_COUNT++))
else
    echo "‚ùå [5/8] Cloud Storage issue"
fi

# Check 6: unzip available
if command -v unzip >/dev/null 2>&1; then
    echo "‚úÖ [6/8] unzip tool available"
    ((READY_COUNT++))
else
    echo "‚ùå [6/8] unzip not available (install: sudo apt-get install unzip)"
fi

# Check 7: Disk space
AVAILABLE_GB=$(df -BG ~ | awk 'NR==2 {print $4}' | sed 's/G//')
if [ "$AVAILABLE_GB" -gt 5 ]; then
    echo "‚úÖ [7/8] Sufficient disk space (${AVAILABLE_GB}GB available)"
    ((READY_COUNT++))
else
    echo "‚ö†Ô∏è  [7/8] Low disk space (${AVAILABLE_GB}GB available)"
fi

# Check 8: Network connectivity
if curl -s -o /dev/null -w "%{http_code}" https://www.google.com -m 5 | grep -q "200"; then
    echo "‚úÖ [8/8] Network connectivity OK"
    ((READY_COUNT++))
else
    echo "‚ùå [8/8] Network connectivity issue"
fi

echo ""
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "READINESS SCORE: $READY_COUNT/$TOTAL_CHECKS checks passed"

if [ $READY_COUNT -ge 6 ]; then
    echo "‚úÖ SYSTEM READY Œ≥ŒπŒ± v3.1 upgrade!"
else
    echo "‚ö†Ô∏è  Some issues detected - review above"
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üìä DIAGNOSTIC COMPLETE - Ready Œ≥ŒπŒ± STEP 2"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
